# nginx.conf

# サーバーの設定
server {
    # Cloud Runが提供するデフォルトのポート8080をリッスン
    listen 8080;
    server_name localhost;

    # ドキュメントのルートディレクトリ
    # Dockerfileで、Expoのビルド成果物(`dist`フォルダの中身)をこの場所にコピーします
    root   /usr/share/nginx/html;

    # デフォルトで表示するファイル
    index  index.html index.htm;

    # この設定がReact Native for Web (Expo)のようなSPAで最も重要です
    location / {
        # リクエストされたURLに合致するファイルやディレクトリを探し、
        # 見つからなければ、すべてのリクエストをWebアプリの入り口である /index.html に転送します。
        # これにより、Reactの画面遷移（ルーティング）が正しく機能します。
        try_files $uri $uri/ /index.html;
    }

    # 画像やCSS、JSファイルなどの静的アセットに対するキャッシュ設定
    # ブラウザに1年間キャッシュさせることで、2回目以降の表示を高速化します
    location ~* \.(?:css|js|ico|gif|jpe?g|png|svg|woff|woff2|ttf)$ {
        expires 1y;
        add_header Cache-Control "public";
    }
}